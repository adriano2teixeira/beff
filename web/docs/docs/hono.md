---
sidebar_position: 3
---

# @beff/hono

`@beff/hono` transforms your router into a [`Hono`](https://hono.dev/) app.

Hono can be used to perform authentication, logging, rate-limiting and much more on top of your app.

Notice that, for most use cases, `use middleware` should be enough. [Learn more about use middleware.](/docs/cli#middleware-use)

## Installation

```bash
npm install @beff/hono
```

## Exports

### Ctx

`Ctx` (`Context`) contains the `context` optional argument you pass to `buildHonoApp` and the `Hono` context.

#### Example

If no type arguments are passed to Ctx, it defaults to an object that contains a single property `Hono` with the [`Hono` context](https://hono.dev/api/context).

```ts title="/router.ts"
import { Ctx } from "@beff/hono";

export default {
  "/hello": {
    get: (c: Ctx) => {
      return c.hono.get("messsage");
    },
  },
};
```

#### Advanced Example

The first argument of a handler function must always be called `Ctx`. If you need to customize it, import it with a different name create a new type called `Ctx`.

The first type argument of `Ctx` must be an object with dependencies you provide when creating the app. The second argument is the [Hono environment](https://hono.dev/api/hono#generics).

```ts title="/router.ts"
import { Ctx as BeffCtx } from "@beff/hono";

// highlight-start
type Ctx = BeffCtx<
  // You can use any types as the first argument
  // as long as you provide them when building the app.
  { log: (msg: string) => void },
  // Hono specific configuration
  { KV_BINDING: KVNamespace }
>;
// highlight-end

export default {
  "/items/{item_id}": {
    get: (c: Ctx, item_id: string) => {
      // highlight-start
      c.log(`Getting item ${item_id}`);
      return c.hono.env.KV_BINDING.get(item_id);
      // highlight-end
    },
  },
};
```

```ts title="/index.ts"
import { buildHonoApp } from "@beff/hono";
import router from "./router";
import generated from "./generated/router";

export const app = buildHonoApp({
  router,
  generated,
  // highlight-start
  context: {
    log: (msg: string) => console.log(msg),
  },
  // highlight-end
});
```

### buildHonoApp

Creates a `Hono` app from the router. Supports customizing the automatic generated documentation.

#### Arguments

| Option                   | Required | Description                                                        |
| ------------------------ | -------- | ------------------------------------------------------------------ |
| generated                | Y        | The router code generated by @beff/cli                             |
| router                   | Y        | The router default export                                          |
| servers                  | N        | A list of OpenAPI servers                                          |
| transformOpenApiDocument | N        | A function that receives the OpenAPI schema and returns the schema |
| context                  | N        | Any object. Useful for dependency injection                        |

#### Example

```ts title="/index.ts"
import { serve } from "@hono/node-server";
import { buildHonoApp } from "@beff/hono";
import router from "./router";
import generated from "./generated/router";

const app = buildHonoApp({
  router,
  generated,
});
serve({
  fetch: app.fetch,
  port: 3040,
});

console.log(`Server running at http://localhost:3040/`);
console.log(`Check docs at at http://localhost:3040/docs`);
```

#### Servers Example

If the API is not hosted on the root path of the server, set it's root path in the servers field, otherwise the interactive documentation won't be able to send requests.

```ts title="/index.ts"
import { serve } from "@hono/node-server";
import { buildHonoApp } from "@beff/hono";
import router from "./router";
import generated from "./generated/router";
import { Hono } from "hono";

const api = buildHonoApp({
  router,
  generated,
  // highlight-start
  servers: [
    {
      url: "/api",
    },
  ],
  // highlight-end
});

const app = new Hono();
// highlight-start
app.route("/api", api);
// highlight-end
serve({
  fetch: app.fetch,
  port: 3040,
});

console.log(`Server running at http://localhost:3040/api`);
console.log(`Check docs at at http://localhost:3040/api/docs`);
```

### buildHonoTestClient

Creates a client for your router, like the one provided by [`@beff/client`](/docs/client). Even though using it seems to be using the router directly, the client does create an HTTP request and calls the router with it. Writing tests for your router has never been easier.

#### Example

```ts title="/router.test.ts"
import { test, expect } from "vitest";
import { buildHonoTestClient, buildHonoApp } from "@beff/hono";
import router from "./router";
import generated from "./generated/router";

const app = buildHonoApp({
  router,
  generated,
});

const client = buildHonoTestClient<typeof router>({ app, generated });

test("get /", async () => {
  const result = await client["/"].get();
  expect(result).toMatchInlineSnapshot(`
    {
      "Hello": "World",
    }
  `);
});
test("get /items/{item_id}", async () => {
  const result = await client["/items/{item_id}"].get(
    "the item id",
    "query param"
  );
  expect(result).toMatchInlineSnapshot(`
    {
      "item_id": "the item id",
      "q": "query param",
    }
  `);
});
```

### isBeffHttpException

Checks whether an exception was thrown by the Beff runtime.

#### Example

The code is based on the [Hono Error Handling example](https://hono.dev/api/hono#error-handling).

```ts
import { isBeffHttpException } from "@beff/hono";

app.onError((err, c) => {
  if (isBeffHttpException(err)) {
    return c.text("Bff error", 500);
  }
  return c.text("Custom Error Message", 500);
});
```
